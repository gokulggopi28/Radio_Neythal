function Message(a, b) { var c = this; c.message = a.message, c.author = a.author, c.date = a.date, c.key = b } function Photo(a, b) { var c = this; c.caption = a.caption, c.url = a.url, c.date = a.date, c.key = b } function Video(a, b) { var c = this; c.caption = a.caption, c.url = a.url, c.date = a.date, c.thumbnail = a.thumbnail, c.key = b } function LiveVideo(a) { var b = this; b.caption = a.caption, b.liveurl = a.liveurl, b.date = a.date, b.thumbnail = a.thumbnail } function SivaGiriViewModel() { var a = this; a.messages = ko.observableArray([]), a.selectedmessage = ko.observable(), a.selectmessage = function (b) { a.selectedmessage(b) }, a.getmessagelist = function () { var b = firebase.database().ref("messages/"); b.on("child_added", function (a) { if (null !== a.val()) { var b = new Message(a.val(), a.key); vm.messages.unshift(b) } }), b.on("child_removed", function (b) { if (null !== b.val()) { var c = new Message(b.val(), b.key), d = ko.utils.arrayFirst(a.messages(), function (a) { return a.key === c.key }); d && a.messages.remove(d) } }) }, a.photos = ko.observableArray([]), a.selectedphoto = ko.observable(), a.selectphoto = function (b) { a.selectedphoto(b), $("#selectedImgCaption").text(b.caption), $("#selectedImg").attr("src", b.url), fullscreen = !0 }, a.getphotolist = function () { var b = firebase.database().ref("photos/"); b.on("child_added", function (a) { if (null !== a.val()) { var b = new Photo(a.val(), a.key); vm.photos.unshift(b) } }), b.on("child_removed", function (b) { if (null !== b.val()) { var c = new Photo(b.val(), b.key), d = ko.utils.arrayFirst(a.photos(), function (a) { return a.key === c.key }); d && a.photos.remove(d) } }), b.on("child_changed", function (b) { if (null !== b.val()) { var c = new Photo(b.val(), b.key), d = ko.utils.arrayFirst(a.photos(), function (a) { return a.key === c.key }); d && a.photos.replace(d, c) } }) }, a.videos = ko.observableArray([]), a.selectedvideo = ko.observable(), a.selectvideo = function (b) { a.selectedvideo(b) }, a.getvideolist = function () { var b = firebase.database().ref("videos/"); b.on("child_added", function (a) { if (null !== a.val()) { var b = new Video(a.val(), a.key); vm.videos.unshift(b) } }), b.on("child_removed", function (b) { if (null !== b.val()) { var c = new Video(b.val(), b.key), d = ko.utils.arrayFirst(a.videos(), function (a) { return a.key === c.key }); d && a.videos.remove(d) } }), b.on("child_changed", function (b) { if (null !== b.val()) { var c = new Video(b.val(), b.key), d = ko.utils.arrayFirst(a.videos(), function (a) { return a.key === c.key }); d && a.videos.replace(d, c) } }) }, a.livevideo = ko.observable(), a.getlivevideo = function () { var a = firebase.database().ref("livevideo/"); a.on("value", function (a) { 0 === liveVideoCounter ? ($("#liveContainer").show(), $("#loaderImg").hide(), vm.livevideo(a.val()), liveVideoCounter++) : ($("#liveContainer").show(), $("#loaderImg").hide(), $("#liveDiv").show(), $("#latestDiv").text("New Live Video!"), vm.livevideo(a.val()), liveVideoCounter++) }) }, a.playlivevideo = function (a) { var b = getParameterByName("v", a.liveurl); window.youtube.playVideo(b, 0, !0, !1) }, a.playarchivedvideo = function (a) { var b = getParameterByName("v", a.url); window.youtube.playVideo(b, 0, !0, !1) }, a.postmessage = function () { var a = $("#txtname").val(), b = $("#txtmessage").val(); return "" === a || "" === b ? (navigator.notification.alert("Please enter the message and name", alertDismissed, "Need more info", "Done"), !1) : void $.ajax({ type: "POST", url: ws_base_url + "postmessage", data: { name: a, new_messages: b }, dataType: "JSON", success: function () { navigator.notification.alert("Waiting for admin's approval", alertDismissed, "Message posted", "Done"), $("#newMessage").modal("close"), $("#txtname").val(""), $("#txtmessage").val(""), messagescreen = !1 }, error: function () { navigator.notification.alert("Could not post the message.Please try again", alertDismissed, "Server is not reachable!", "Done") } }) } } function showNextTab() { var a = $("#topMenu li .active").parent().next(); $("#topMenu li .active").removeClass(":focus"), $(a).find("a").trigger("click") } function showPrevTab() { var a = $("#topMenu li .active").parent().prev(); $("#topMenu li .active").removeClass(":focus"), $(a).find("a").trigger("click") } function getParameterByName(a, b) { a = a.replace(/[\[\]]/g, "\\$&"); var c = new RegExp("[?&]" + a + "(=([^&#]*)|&|#|$)"), d = c.exec(b); return d ? d[2] ? decodeURIComponent(d[2].replace(/\+/g, " ")) : "" : null } function alertDismissed() { networkerrorshown = !1 } var config = { apiKey: "AIzaSyAqRiizgswOkPBmv_fQqKy_KEJFShgoeBo", authDomain: "sivagiri-48eed.firebaseapp.com", databaseURL: "https://sivagiri-48eed.firebaseio.com", storageBucket: "sivagiri-48eed.appspot.com", messagingSenderId: "498704138599" }; firebase.initializeApp(config); var ws_base_url = "https://guru.techgentsia.com/webservice/", liveVideoCounter = 0, fullscreen = !1, messagescreen = !1, networkerrorshown = !1, vm = new SivaGiriViewModel; ko.applyBindings(vm); var indexPage = 1; $(document).ready(function () { $("#photos").on("click", ".img-view", function () { $(".image-container").fadeToggle("300", "linear") }), $(".back").click(function () { $(".image-container").fadeToggle("300", "linear"), fullscreen = !fullscreen }), $(".img-full").click(function () { $(".header").toggleClass("full-scr"), $(".image-container").toggleClass("dark") }), $(".modal").modal(), $("#btnNewMsg").click(function () { messagescreen = !0 }), $("#btnMsgClose").click(function () { messagescreen = !1, $("#newMessage").modal("close") }), $(".tab-content").swipe({ swipeLeft: function () { showNextTab() }, swipeRight: function () { showPrevTab() } }), $("#page4").click(function () { $("#addNewMsg").show() }), $("#page1,#page2,#page3").click(function () { $("#addNewMsg").hide() }), vm.getlivevideo(), vm.getmessagelist(), vm.getphotolist(), vm.getvideolist() });